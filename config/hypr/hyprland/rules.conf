# ╔══════════════════════════════════════════════════════════════════════════════╗
# ║                              HYPRLAND RULES                                  ║
# ╚══════════════════════════════════════════════════════════════════════════════╝

# ┌──────────────────────────────────────────────────────────────────────────────┐
# │                            1. GLOBAL SETTINGS                                │
# └──────────────────────────────────────────────────────────────────────────────┘

# Uncomment to apply global transparency to all windows:
# windowrule = opacity 0.89 override 0.89 override, match:class .*

# No shadow for tiled windows
windowrule = no_shadow on, match:float false

# ┌──────────────────────────────────────────────────────────────────────────────┐
# │                          2. WORKSPACE ASSIGNMENTS                            │
# └──────────────────────────────────────────────────────────────────────────────┘

# windowrule = workspace 1 silent, match:class ^(zen-browser|zen)$
# windowrule = workspace 1 silent, match:class ^(floorp)$
# windowrule = workspace 2 silent, match:class ^(cursor)$
# windowrule = workspace 3 silent, match:class ^(code|Code|VSCodium)$
# windowrule = workspace 4 silent, match:class ^(?i)tradingview.*$
# windowrule = workspace 5 silent, match:class ^(?i)spotify.*$

# ┌──────────────────────────────────────────────────────────────────────────────┐
# │                      3. FLOATING PRESETS (REUSABLE)                          │
# │                                                                              │
# │  Use `tag +<preset>` in per-app rules to apply these presets.                │
# │  Docs: https://wiki.hypr.land/Configuring/Window-Rules/                      │
# └──────────────────────────────────────────────────────────────────────────────┘

# --- Centered presets ---
windowrule {
  name = preset-float-center
  match:tag = fp_center
  float = on
  center = on
}

windowrule {
  name = preset-float-45x45
  match:tag = fp_45x45
  float = on
  center = on
  size = (monitor_w*0.45) (monitor_h*0.45)
}

windowrule {
  name = preset-float-45x55
  match:tag = fp_45x55
  float = on
  center = on
  size = (monitor_w*0.45) (monitor_h*0.55)
}

windowrule {
  name = preset-float-55x70
  match:tag = fp_55x70
  float = on
  center = on
  size = (monitor_w*0.55) (monitor_h*0.7)
}

windowrule {
  name = preset-float-60x65
  match:tag = fp_60x65
  float = on
  center = on
  size = (monitor_w*0.6) (monitor_h*0.65)
}

# --- Corner presets ---
windowrule {
  name = preset-float-top-right
  match:tag = fp_top_right
  float = on
  size = (monitor_w*0.2) (monitor_h*0.5)
  move = (monitor_w*0.795) (monitor_h*0.04)
}

windowrule {
  name = preset-float-bottom-right
  match:tag = fp_bottom_right
  float = on
  size = (monitor_w*0.2) (monitor_h*0.5)
  move = (monitor_w*0.795) (monitor_h*0.49)
}

# ┌──────────────────────────────────────────────────────────────────────────────┐
# │                        4. FILE DIALOGS (FLOATING)                            │
# └──────────────────────────────────────────────────────────────────────────────┘

windowrule = float on, match:title ^(Open File)(.*)$
windowrule = center on, match:title ^(Open File)(.*)$
windowrule = float on, match:title ^(Select a File)(.*)$
windowrule = center on, match:title ^(Select a File)(.*)$
windowrule = float on, match:title ^(Open Folder)(.*)$
windowrule = center on, match:title ^(Open Folder)(.*)$
windowrule = float on, match:title ^(Save As)(.*)$
windowrule = center on, match:title ^(Save As)(.*)$
windowrule = float on, match:title ^(File Upload)(.*)$
windowrule = center on, match:title ^(File Upload)(.*)$
windowrule = float on, match:title ^(.*)(wants to save)$
windowrule = center on, match:title ^(.*)(wants to save)$
windowrule = float on, match:title ^(.*)(wants to open)$
windowrule = center on, match:title ^(.*)(wants to open)$
windowrule = float on, match:title ^(Choose wallpaper)(.*)$
windowrule = center on, match:title ^(Choose wallpaper)(.*)$
windowrule = size (monitor_w*0.6) (monitor_h*0.65), match:title ^(Choose wallpaper)(.*)$
windowrule = float on, match:title ^(Library)(.*)$
windowrule = center on, match:title ^(Library)(.*)$
windowrule = tag +fp_45x45, match:title ^(Library)$

# ┌──────────────────────────────────────────────────────────────────────────────┐
# │                          5. APP-SPECIFIC RULES                               │
# └──────────────────────────────────────────────────────────────────────────────┘

# --- System utilities ---
windowrule = tag +fp_45x45, match:class ^(pavucontrol)$
windowrule = tag +fp_45x45, match:class ^(org.pulseaudio.pavucontrol)$
windowrule = tag +fp_55x70, match:class ^(pavucontrol-qt)$
windowrule = tag +fp_45x45, match:class ^(nm-connection-editor)$
windowrule = tag +fp_45x45, match:class ^(kcm_bluetooth)$
windowrule = tag +fp_45x55, match:class ^(org.kde.bluedevilwizard)$
windowrule = float on, match:class ^(blueberry\.py)$

# --- KDE/Plasma ---
windowrule = float on, match:class .*plasmawindowed.*
windowrule = float on, match:class kcm_.*
windowrule = float on, match:class .*bluedevilwizard
windowrule = tag +fp_60x65, match:class org.freedesktop.impl.portal.desktop.kde
windowrule = float on, match:class ^(plasma-changeicons)$
windowrule = no_initial_focus on, match:class ^(plasma-changeicons)$
windowrule = move (monitor_w*0.999999) (monitor_h*0.999999), match:class ^(plasma-changeicons)$

# --- Specific apps ---
windowrule = tag +fp_top_right, match:class ^(protonvpn-app)$
windowrule = tag +fp_45x45, match:class ^(Zotero)$
windowrule = tag +fp_55x70, match:title ^(illogical-impulse Settings)$
windowrule = float on, match:class ^(guifetch)$
windowrule = float on, match:title .*Welcome
windowrule = float on, match:title .*Shell conflicts.*
windowrule = tile on, match:class ^dev\.warp\.Warp$
windowrule = move (monitor_w*0.4) (monitor_h*0.8), match:title ^(Copying — Dolphin)$

# --- JetBrains IDEs ---
windowrule = no_initial_focus on, match:class ^jetbrains-.*$, match:float true, match:title ^$|^\s$|^win\d+$

# ┌──────────────────────────────────────────────────────────────────────────────┐
# │                          6. PICTURE-IN-PICTURE                               │
# └──────────────────────────────────────────────────────────────────────────────┘

windowrule = float on, match:title ^([Pp]icture[-\s]?[Ii]n[-\s]?[Pp]icture)(.*)$
windowrule = keep_aspect_ratio on, match:title ^([Pp]icture[-\s]?[Ii]n[-\s]?[Pp]icture)(.*)$
windowrule = size (monitor_w*0.25) (monitor_h*0.25), match:title ^([Pp]icture[-\s]?[Ii]n[-\s]?[Pp]icture)(.*)$
windowrule = move (monitor_w*0.73) (monitor_h*0.72), match:title ^([Pp]icture[-\s]?[Ii]n[-\s]?[Pp]icture)(.*)$
windowrule = pin on, match:title ^([Pp]icture[-\s]?[Ii]n[-\s]?[Pp]icture)(.*)$

# ┌──────────────────────────────────────────────────────────────────────────────┐
# │                    7. XWAYLAND / WINE / PERFORMANCE                          │
# └──────────────────────────────────────────────────────────────────────────────┘

# Disable blur for empty XWayland context menus
windowrule = no_blur on, match:xwayland true, match:class ^$, match:title ^$

# XWayland performance optimizations
windowrule = immediate on, match:xwayland true
windowrule = no_blur on, match:xwayland true
windowrule = no_shadow on, match:xwayland true
windowrule = no_anim on, match:xwayland true

# Wine applications — ổn định tương tác trên XWayland:
# - immediate: giảm input lag, hạn chế lỗi focus (cần allow_tearing trong general)
# - no_blur/no_shadow/no_anim: giảm tải compositor, dialog/popup ít bị kẹt
# Nếu dialog Wine không nhận click: trong winecfg tắt "Emulate a virtual desktop"
windowrule = immediate on, match:title .*\.exe
windowrule = immediate on, match:class ^(?i)wine.*
windowrule = immediate on, match:class ^(?i)wine64.*
windowrule = immediate on, match:class ^(?i)wine32.*
windowrule = no_blur on, match:class ^(?i)wine.*
windowrule = no_shadow on, match:class ^(?i)wine.*
windowrule = no_anim on, match:class ^(?i)wine.*

# Gaming
windowrule = immediate on, match:title .*minecraft.*
windowrule = immediate on, match:class ^(steam_app).*

# TradingView (Electron) - avoid compositor crashes
windowrule = immediate on, match:class ^(?i)tradingview.*
windowrule = no_blur on, match:class ^(?i)tradingview.*
windowrule = no_shadow on, match:class ^(?i)tradingview.*
windowrule = no_anim on, match:class ^(?i)tradingview.*

# ╔══════════════════════════════════════════════════════════════════════════════╗
# ║                            WORKSPACE RULES                                   ║
# ╚══════════════════════════════════════════════════════════════════════════════╝

workspace = special:special, gapsout:30

# ╔══════════════════════════════════════════════════════════════════════════════╗
# ║                              LAYER RULES                                     ║
# ╚══════════════════════════════════════════════════════════════════════════════╝

# ┌──────────────────────────────────────────────────────────────────────────────┐
# │                              1. GLOBAL                                       │
# └──────────────────────────────────────────────────────────────────────────────┘

layerrule = xray 1, match:namespace .*
# layerrule = no_anim on, match:namespace .*

# ┌──────────────────────────────────────────────────────────────────────────────┐
# │                         2. LAUNCHERS / UTILITIES                             │
# └──────────────────────────────────────────────────────────────────────────────┘

layerrule = no_anim on, match:namespace walker
layerrule = no_anim on, match:namespace anyrun
layerrule = no_anim on, match:namespace selection
layerrule = no_anim on, match:namespace hyprpicker
layerrule = no_anim on, match:namespace noanim
layerrule = no_anim on, match:namespace gtk4-layer-shell

# ┌──────────────────────────────────────────────────────────────────────────────┐
# │                           3. GTK LAYER SHELL                                 │
# └──────────────────────────────────────────────────────────────────────────────┘

layerrule = blur on, match:namespace gtk-layer-shell
layerrule = ignore_alpha 0, match:namespace gtk-layer-shell
layerrule = blur on, match:namespace launcher
layerrule = ignore_alpha 0.5, match:namespace launcher
layerrule = blur on, match:namespace notifications
layerrule = ignore_alpha 0.69, match:namespace notifications
layerrule = blur on, match:namespace logout_dialog

# ┌──────────────────────────────────────────────────────────────────────────────┐
# │                                4. AGS                                        │
# └──────────────────────────────────────────────────────────────────────────────┘

layerrule = animation slide left, match:namespace sideleft.*
layerrule = animation slide right, match:namespace sideright.*
layerrule = no_anim on, match:namespace overview
layerrule = no_anim on, match:namespace indicator.*
layerrule = no_anim on, match:namespace osk

layerrule = blur on, match:namespace session[0-9]*
layerrule = blur on, match:namespace bar[0-9]*
layerrule = ignore_alpha 0.6, match:namespace bar[0-9]*
layerrule = blur on, match:namespace barcorner.*
layerrule = ignore_alpha 0.6, match:namespace barcorner.*
layerrule = blur on, match:namespace dock[0-9]*
layerrule = ignore_alpha 0.6, match:namespace dock[0-9]*
layerrule = blur on, match:namespace indicator.*
layerrule = ignore_alpha 0.6, match:namespace indicator.*
layerrule = blur on, match:namespace overview[0-9]*
layerrule = ignore_alpha 0.6, match:namespace overview[0-9]*
layerrule = blur on, match:namespace cheatsheet[0-9]*
layerrule = ignore_alpha 0.6, match:namespace cheatsheet[0-9]*
layerrule = blur on, match:namespace sideright[0-9]*
layerrule = ignore_alpha 0.6, match:namespace sideright[0-9]*
layerrule = blur on, match:namespace sideleft[0-9]*
layerrule = ignore_alpha 0.6, match:namespace sideleft[0-9]*
layerrule = blur on, match:namespace osk[0-9]*
layerrule = ignore_alpha 0.6, match:namespace osk[0-9]*

# ┌──────────────────────────────────────────────────────────────────────────────┐
# │                             5. QUICKSHELL                                    │
# └──────────────────────────────────────────────────────────────────────────────┘

# Global quickshell
layerrule = blur_popups on, match:namespace quickshell:.*
layerrule = blur on, match:namespace quickshell:.*
layerrule = ignore_alpha 0.79, match:namespace quickshell:.*

# Specific components
layerrule = ignore_alpha 0.15, match:namespace quickshell:dock
layerrule = animation slide, match:namespace quickshell:bar
layerrule = animation slide, match:namespace quickshell:verticalBar
layerrule = animation slide bottom, match:namespace quickshell:cheatsheet
layerrule = animation slide bottom, match:namespace quickshell:dock
layerrule = animation slide bottom, match:namespace quickshell:osk
layerrule = animation slide top, match:namespace quickshell:wallpaperSelector
layerrule = animation slide right, match:namespace quickshell:sidebarRight
layerrule = animation slide left, match:namespace quickshell:sidebarLeft
layerrule = animation popin 120%, match:namespace quickshell:screenCorners
layerrule = animation fade, match:namespace quickshell:notificationPopup

# No animation
layerrule = no_anim on, match:namespace quickshell:lockWindowPusher
layerrule = no_anim on, match:namespace quickshell:overlay
layerrule = no_anim on, match:namespace quickshell:overview
layerrule = no_anim on, match:namespace quickshell:polkit
layerrule = no_anim on, match:namespace quickshell:regionSelector
layerrule = no_anim on, match:namespace quickshell:screenshot
layerrule = no_anim on, match:namespace quickshell:session

# Special cases
layerrule = xray 0, match:namespace quickshell:popup
layerrule = ignore_alpha 1, match:namespace quickshell:popup
layerrule = ignore_alpha 1, match:namespace quickshell:mediaControls
layerrule = blur on, match:namespace quickshell:session
layerrule = ignore_alpha 0, match:namespace quickshell:session

# ┌──────────────────────────────────────────────────────────────────────────────┐
# │                             6. DISABLED                                      │
# └──────────────────────────────────────────────────────────────────────────────┘

# Vicinae
# layerrule = blur on, match:namespace vicinae
# layerrule = ignore_alpha 0, match:namespace vicinae
# layerrule = no_anim on, match:namespace vicinae
